
WITH PED AS (
SELECT ID_PEDIDO,
PEDVRTOTAL,
PEDVRDESCTO DESCTO

FROM 

PEDID 

WHERE ID_PEDIDO IN (11616060,11622439,11631277,11633240,11634591,11635124,11640523,11640526,11649481,11651636,11653050,11653084,11653492,11656000,11656953,11664478,11664481,11667477,11684350,11684556,11691314,11691546,11693251,11734784,11737504,11738119,11739561,11748476,11755131,11755144,11760194,11769339,11771228,11779960,11783626,11784310,11787242,11793941,11796677,11797328,11806680,11811307,11824130,11825401,11833956,11839223,11853397,11867831,11877877,11879224,11884350,11885252,11893104,11894018,11897598,11898760,11901029,11902541,11904624,11915394,11919245,11921336,11923908,11928055,11929056,11930180,11933814,11953876,11954856,11955496,11958244,11961215,11971191,11976371,11987169,11988502,11999307,12006972,12007375,12009517,12011920,12014542,12024861,12026128,12028762,12029434,12038073,12042150,12050230,12052092,12060447,12063792,12068388,12076881,12087096,12087505,12096531,12098719,12109511,12123140,12127956,12128575,12129744,12133581,12136091,12137873,12138467,12144025,12146144,12151505,12151760,12153209,12155691,12157133,12158328,12158799,12160042,12165485,12168948,12172419,12179517,12185320,12185342,12191017,12194040,12194513,12200507,12217931,12219716,12222272,12237785,12244515,12248069,12276466,12294691,12298324,12300835,12302989,12303858,12307246,12309182,12312225,12324794,12328865,12332330,12335238,12340927,12341947,12343858,12349450,12351224,12354552,12360887,12362344,12366422,12367341,12367892,12367946,12368228,12369315,12376063,12378211,12383079,12394766,12405023,12412625,12412722,12414318,12415808,12418494,12420359,12424220,12424385,12424430,12431318,12432416,12433520,12433672,12434193,12442426,12443529,12446422,12451946,12455034,12461982,12464858,12473325,12480341,12481526,12481537,12485434,12488733,12488746,12496053,12499180,12499657,12501903,12506502,12506986,12513241,12513299,12516897,12517564,12520119,12524391,12525274,12526454,12535130,12538500,12539742,12542301,12542499,12544580,12546747,12548165,12548380,12548473,12549222,12549893,12552152,12554282,12557956,12560607,12560889,12561178,12561456,12562146,12563085,12563453,12564430,12564522,12565708,12566547,12566794,12567804,12569861,12570753,12571525,12573902,12576830,12578880,12584597,12586362,12587942,12588748,12589816,12591771,12592579,12593097,12598049,12600638,12602312,12603876,12612478,12613520,12615778,12619863,12621277,12621540,12626675,12626753,12638659,12639779,12646813,12658825,12661077,12663753,12671549,12672927,12680950,12690459,12731986,12733351,12740640,12748083,12773762,12786576,12792970,12794523,12797340,12800542,12813766,12817215,12821610,12824397,12844685,12851371,12856055,12857247,12861827,12864026,12886945,12887281,12888633,12902290,12904628,12913342,12914353,12919634,12920221,12922330,12949960,12950664,12952234,12956552,12957083,12962919,12963038,12965241,12975959,12978211,12979743,12987756,12992249,12998378,13001455,13002313,13006484,13010105,13011430,13013637,13018524,13023750,13041391,13072629,13076810,13086440,13088721,13089656,13093314,13097916,13111117,13113185,13115451,13116256,13122500,13123890,13124142,13128867,13135192,13139269,13158154,13158960,13163442,13204847,13209653,13213508,13232987,13238386,13238510,13238977,13247792,13252142)

),

PROD1 AS (SELECT PROCODIGO FROM PRODU WHERE  PROTIPO IN ('P','F','E') AND PROCODIGO NOT IN ('AC0062','AC0063')),

PROD2 AS (SELECT PROCODIGO FROM PRODU WHERE  PROTIPO IN ('T')),


PED_LEN AS (SELECT PR.ID_PEDIDO,
                    PR.PROCODIGO LENTE, 
                     PDPDESCRICAO DESC_LENTE,
                      SUM(PDPUNITLIQUIDO*PDPQTDADE)VRLENTE
                       FROM PDPRD PR
INNER JOIN PED PD ON PR.ID_PEDIDO=PD.ID_PEDIDO
INNER JOIN PROD1 PRD ON PR.PROCODIGO=PRD.PROCODIGO
GROUP BY 1,2,3
),

PED_TRAT AS (SELECT PR.ID_PEDIDO,
                    PR.PROCODIGO TRAT, 
                     PDPDESCRICAO DESC_TRAT,
                      SUM(PDPUNITLIQUIDO*PDPQTDADE)VRTRAT
                       FROM PDPRD PR
INNER JOIN PED PD ON PR.ID_PEDIDO=PD.ID_PEDIDO
INNER JOIN PROD2 PRD ON PR.PROCODIGO=PRD.PROCODIGO
GROUP BY 1,2,3
)



SELECT * FROM PED P
 LEFT JOIN PED_LEN PL ON PL.ID_PEDIDO=P.ID_PEDIDO
  LEFT JOIN PED_TRAT PT ON PT.ID_PEDIDO=P.ID_PEDIDO
 





